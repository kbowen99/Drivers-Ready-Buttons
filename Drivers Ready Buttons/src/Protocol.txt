#include <Arduino.h>

#define NUM_LEDS 12
#define MESSAGE_LENGTH 39
#define buttonID 0x01

#define MESSAGE_PATTERN 0xB7

int currentImage[NUM_LEDS][3];
bool imageChanged = false;

void setup() {
  // put your setup code here, to run once:
}

void loop() {
  // put your main code here, to run repeatedly:
}

void send_Button_Pressed() {
  byte message[4];
  message[0] = MESSAGE_PATTERN;
  message[1] = 0x00;
  message[2] = 0x02;
  message[3] = buttonID;

  Serial.write(message,4);
}

//extracts data after message pattern is matched
void Parse_DRB_Message(byte message[]) {
  //ignore byte 0 (message pattern)

  //parse device ID (byte 1)
  byte DeviceID = message[1];

  //parse message type (byte 2)
  byte messageType = message[2];

  switch (messageType){
    case (0x01):
      //parse image data (bytes 3-38)
      for (short i = 3; i < 39; i++) {
        currentImage[(i-3)/3][i%3] = int(message[i]);
      }
      imageChanged = true;
      break;

    default:
      break;
  }

}

void serialEvent() {
  while (Serial.available()) {
    byte inByte = Serial.read();

    if (inByte == MESSAGE_PATTERN) {
      byte message[MESSAGE_LENGTH];
      message[0] = inByte;
      for (short i = 1; i < 37; i++) {
        message[i] = Serial.read();
      }
      Parse_DRB_Message(message);
    }
  }
}